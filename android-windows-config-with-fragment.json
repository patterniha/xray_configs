// config with fragment v6 (android, windows)
{
  "log": {
    "loglevel": "warning","dnsLog": false
  },
   "dns":{"hosts": {
"geosite:category-ads-all": ["0.0.0.0","0:0:0:0:0:0:0:0"],
"ext:iran.dat:ads": ["0.0.0.0","0:0:0:0:0:0:0:0"],
"geosite:category-porn": ["0.0.0.0","0:0:0:0:0:0:0:0"]
},
"servers": [{"address": "fakedns","domains": ["geosite:private", "ext:iran.dat:all", "geosite:category-ir"]},
             "tcp://49.12.223.2",
             "tcp://49.12.43.208",
            {"address": "localhost","domains": ["geosite:private", "ext:iran.dat:all", "geosite:category-ir"], "expectIPs": ["0.0.0.0/5", "8.0.0.0/7", "10.0.0.0/13", "10.8.0.0/15", "10.10.0.0/19", "10.10.32.0/23", "10.10.35.0/24", "10.10.36.0/22", "10.10.40.0/21", "10.10.48.0/20", "10.10.64.0/18", "10.10.128.0/17", "10.11.0.0/16", "10.12.0.0/14", "10.16.0.0/12", "10.32.0.0/11", "10.64.0.0/10", "10.128.0.0/9", "11.0.0.0/8", "12.0.0.0/6", "16.0.0.0/4", "32.0.0.0/3", "64.0.0.0/2", "128.0.0.0/1", "::/9", "80::/10", "c0::/12", "d0::/124", "d0::10/128", "d0::12/127", "d0::14/126", "d0::18/125", "d0::20/123", "d0::40/122", "d0::80/121", "d0::100/120", "d0::200/119", "d0::400/118", "d0::800/117", "d0::1000/116", "d0::2000/115", "d0::4000/114", "d0::8000/113", "d0::1:0/112", "d0::2:0/111", "d0::4:0/110", "d0::8:0/109", "d0::10:0/108", "d0::20:0/107", "d0::40:0/106", "d0::80:0/105", "d0::100:0/104", "d0::200:0/103", "d0::400:0/102", "d0::800:0/101", "d0::1000:0/100", "d0::2000:0/99", "d0::4000:0/98", "d0::8000:0/97", "d0::1:0:0/96", "d0::2:0:0/95", "d0::4:0:0/94", "d0::8:0:0/93", "d0::10:0:0/92", "d0::20:0:0/91", "d0::40:0:0/90", "d0::80:0:0/89", "d0::100:0:0/88", "d0::200:0:0/87", "d0::400:0:0/86", "d0::800:0:0/85", "d0::1000:0:0/84", "d0::2000:0:0/83", "d0::4000:0:0/82", "d0::8000:0:0/81", "d0::1:0:0:0/80", "d0::2:0:0:0/79", "d0::4:0:0:0/78", "d0::8:0:0:0/77", "d0::10:0:0:0/76", "d0::20:0:0:0/75", "d0::40:0:0:0/74", "d0::80:0:0:0/73", "d0::100:0:0:0/72", "d0::200:0:0:0/71", "d0::400:0:0:0/70", "d0::800:0:0:0/69", "d0::1000:0:0:0/68", "d0::2000:0:0:0/67", "d0::4000:0:0:0/66", "d0::8000:0:0:0/65", "d0:0:0:1::/64", "d0:0:0:2::/63", "d0:0:0:4::/62", "d0:0:0:8::/61", "d0:0:0:10::/60", "d0:0:0:20::/59", "d0:0:0:40::/58", "d0:0:0:80::/57", "d0:0:0:100::/56", "d0:0:0:200::/55", "d0:0:0:400::/54", "d0:0:0:800::/53", "d0:0:0:1000::/52", "d0:0:0:2000::/51", "d0:0:0:4000::/50", "d0:0:0:8000::/49", "d0:0:1::/48", "d0:0:2::/47", "d0:0:4::/46", "d0:0:8::/45", "d0:0:10::/44", "d0:0:20::/43", "d0:0:40::/42", "d0:0:80::/41", "d0:0:100::/40", "d0:0:200::/39", "d0:0:400::/38", "d0:0:800::/37", "d0:0:1000::/36", "d0:0:2000::/35", "d0:0:4000::/34", "d0:0:8000::/33", "d0:1::/32", "d0:2::/31", "d0:4::/30", "d0:8::/29", "d0:10::/28", "d0:20::/27", "d0:40::/26", "d0:80::/25", "d0:100::/24", "d0:200::/23", "d0:400::/22", "d0:800::/21", "d0:1000::/20", "d0:2000::/19", "d0:4000::/18", "d0:8000::/17", "d1::/16", "d2::/15", "d4::/14", "d8::/13", "e0::/11", "100::/8", "200::/7", "400::/6", "800::/5", "1000::/4", "2000::/3", "4000::/2", "8000::/1"], "skipFallback": true}
], "tag": "dnsQuery","disableFallbackIfMatch": true
},

  "fakedns": [
  {
    "ipPool": "198.18.0.0/15",
    "poolSize": 32768
  },
  {
    "ipPool": "fc00::/18",
    "poolSize": 32768
  }
],

  "inbounds": [
   {
      "port": 12353,
      "protocol": "dokodemo-door",
      "settings": {
        "address": "49.12.223.2",
        "port": 53,
        "network": "tcp,udp"
      },
      "tag": "dns-in"
    },
    {
      "tag": "socks-in",
      "port": 12308,
      "protocol": "socks",
      "sniffing": {
            "enabled": true,
            "destOverride": ["http", "tls", "quic", "fakedns", "fakedns+others"],
            "metadataOnly": false,
            "routeOnly": false
                  },
      "settings": {"udp": true}
    }
   
  ],
  "outbounds": [
    {
      "tag": "proxy",
      "protocol": "vless",
      "settings": {
        "vnext": [
          {
            "address": $connect_address$,
            "port": 443,
            "users": [
              {
                "id": $vless_uuid$,
                "encryption": "none"
              }
            ]
          }
        ]
      },
      "streamSettings": {
        "network": "ws",
        "security": "tls",
        "sockopt": {
                    "tcpNoDelay": true // for foragment add here: "dialerProxy": "fragmentt"  
                   },
        "tlsSettings": {
          "serverName": $tls_sni$,
          "alpn": ["h2", "http/1.1"],
          "fingerprint": "randomized"
        },         
        "wsSettings": {
          "path": $ws_path$,
          "headers": {
            "Host": $ws_host$
          }
        }
      }
      
    },  
        {
            "protocol": "freedom",
            "tag": "directuseip",
            "settings": {"domainStrategy": "ForceIP"},
            "streamSettings": {
                "sockopt": {
                    "tcpNoDelay": true
                }
            }
        },
        {
            "protocol": "blackhole",
            "tag": "block"
        },{
      "protocol": "dns",
      "tag": "dns-out",
      "settings": { "nonIPQuery": "skip", "network": "tcp", "address": "49.12.223.2", "port": 53},
      "streamSettings": {
                "sockopt": {
                    "tcpNoDelay": true,
                    "dialerProxy": "proxy"
                   }
            }
          },
          {
            "tag": "fragmentt",
            "protocol": "freedom",
            "settings": {
                "domainStrategy": "ForceIP",
                "fragment": {
                    "packets": "tlshello",
                    "length": "16-31",
                    "interval": "17-19"
                }
            },
            "streamSettings": {
                "sockopt": {
                    "tcpNoDelay": true
                }
            }
        }
  ],"routing": {
    "domainStrategy": "IPIfNonMatch",
    "rules": [
           {"type": "field","outboundTag": "block",
            "domain": ["geosite:category-ads-all", "ext:iran.dat:ads", "geosite:category-porn"]
           },
           {"type": "field","outboundTag": "block",
            "ip": ["0.0.0.0", "0:0:0:0:0:0:0:0", "10.10.34.0/24", "d0:0:0:0:0:0:0:11"]
           },
           {"type": "field","outboundTag": "dns-out",
            "inboundTag": ["dns-in"]
           },
           {"type": "field","outboundTag": "dns-out",
            "inboundTag": ["socks-in"], "port": 53
           },
           {"type": "field","outboundTag": "directuseip",
            "inboundTag": ["dnsQuery"], "network": "udp"
           },
           {"type": "field","outboundTag": "proxy",
            "inboundTag": ["dnsQuery"], "network": "tcp"
           },           
           {"type": "field","outboundTag": "directuseip",
                "domain": ["geosite:private", "ext:iran.dat:all", "geosite:category-ir"] 
           },
           {"type": "field","outboundTag": "directuseip",
            "ip": ["geoip:private", "geoip:ir"]
           },
           {"type": "field","outboundTag": "directuseip",
            "protocol": ["bittorrent"]
           },
           {"type": "field","outboundTag": "directuseip",
            "network": "udp"
           },
           {"type": "field","outboundTag": "directuseip",
            "port": 25
           },
           {"type": "field","outboundTag": "fragmentt",
                "domain": ["geosite:cloudflare"]
           },   
           {"type": "field","outboundTag": "fragmentt",
                "ip": ["geoip:cloudflare"]
           }
  
      ]
  },
    "policy": {
       "levels": {
         "0": {
           "connIdle": 30,
           "uplinkOnly": 0,
           "downlinkOnly": 0
        }
     }
  }

}
